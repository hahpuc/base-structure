<div class="ft-table-container">
  <!-- Table Title -->
  <!-- <div class="table-header" *ngIf="option?.title">
    <h4 class="table-title">{{ option.title }}</h4>
  </div> -->

  <!-- Table Filter -->
  <ft-table-filter
    *ngIf="option?.filterable && option.filters && option.filters.length > 0"
    [filters]="option.filters!"
    [initialFilterValues]="currentFilters"
    (filterChange)="onFilterChange($event)"
    (clearFilter)="onClearFilter()"
  ></ft-table-filter>

  <!-- Responsive Table Container -->
  <div class="table-responsive-container">
    <!-- Table wrapper for horizontal scroll -->
    <div class="table-scroll-wrapper">
      <!-- Basic Ant Design Table -->
      <nz-table
        #basicTable
        [nzData]="tableData"
        [nzLoading]="loading"
        [nzPageSize]="pageSize"
        [nzShowSizeChanger]="false"
        [nzTotal]="total"
        [nzPageIndex]="currentPage"
        [nzPageSizeOptions]="pageSizeOptions"
        (nzPageIndexChange)="onPageChange($event)"
        (nzPageSizeChange)="onPageSizeChange($event)"
        [nzShowPagination]="false"
        nzBordered
        [nzFrontPagination]="false"
      >
        <!-- Table Header -->
        <thead>
          <tr>
            <th
              *ngIf="
                option?.actions && option.actions && option.actions.length > 0
              "
              nzWidth="100px"
              nzLeft
            ></th>
            <th
              *ngFor="let column of option?.columns; trackBy: trackByColumn"
              [nzShowSort]="column.sortable"
              [nzSortFn]="getSortFn(column)"
              [nzSortOrder]="getSortDirection(column)"
              (nzSortOrderChange)="onSortChange(column, $event)"
              [nzWidth]="column.width || '200px'"
              [nzLeft]="column.fixed === 'left'"
              [nzRight]="column.fixed === 'right'"
              [hidden]="!isColumnVisible(column)"
            >
              {{ column.title }}
            </th>
          </tr>
        </thead>

        <!-- Table Body -->
        <tbody>
          <tr *ngFor="let data of basicTable.data; trackBy: trackByData">
            <td
              *ngIf="
                option?.actions && option.actions && option.actions.length > 0
              "
              nzLeft
            >
              <button
                *ngFor="let action of option.actions"
                [title]="action.label"
                (click)="onActionClick(data, action)"
                class="ant-btn-action mr-1 w-[36px] h-[36px] rounded-[36px] flex items-center justify-center bg-blue-50 text-blue-600 hover:bg-blue-200"
                [hidden]="!isActionVisible(action, data)"
              >
                <nz-icon
                  *ngIf="action.iconClass"
                  [nzType]="action.iconClass"
                  nzTheme="outline"
                  class="icon-action"
                />
              </button>
            </td>
            <td
              *ngFor="let column of option?.columns; trackBy: trackByColumn"
              [nzLeft]="column.fixed === 'left'"
              [nzRight]="column.fixed === 'right'"
              [hidden]="!isColumnVisible(column)"
            >
              <ng-container [ngSwitch]="getColumnType(column)">
                <!-- Text Type -->
                <span *ngSwitchCase="'text'">
                  {{ getColumnValue(data, column) }}
                </span>

                <!-- Number Type -->
                <span *ngSwitchCase="'number'">
                  {{ getColumnValue(data, column) | number }}
                </span>

                <!-- Date Type -->
                <span *ngSwitchCase="'date'">
                  {{ getColumnValue(data, column) | date : "dd/MM/yyyy" }}
                </span>

                <!-- DateTime Type -->
                <span *ngSwitchCase="'datetime'">
                  {{ getColumnValue(data, column) | date : "dd/MM/yyyy HH:mm" }}
                </span>

                <!-- Time Type -->
                <span *ngSwitchCase="'time'">
                  {{ getColumnValue(data, column) | date : "HH:mm" }}
                </span>

                <!-- Boolean Type -->
                <span *ngSwitchCase="'boolean'">
                  <nz-tag
                    [nzColor]="getColumnValue(data, column) ? 'green' : 'red'"
                  >
                    {{ getColumnValue(data, column) ? "Yes" : "No" }}
                  </nz-tag>
                </span>

                <!-- Status Type (Switch) -->
                <span *ngSwitchCase="'status'">
                  <nz-switch
                    [ngModel]="getColumnValue(data, column)"
                    [nzDisabled]="isColumnDisabled(data, column)"
                    (ngModelChange)="onStatusChange(data, column, $event)"
                    [nzCheckedChildren]="checkedTemplate"
                    [nzUnCheckedChildren]="unCheckedTemplate"
                  >
                  </nz-switch>

                  <ng-template #checkedTemplate
                    ><nz-icon nzType="check"
                  /></ng-template>
                  <ng-template #unCheckedTemplate
                    ><nz-icon nzType="close"
                  /></ng-template>
                </span>

                <!-- Switch Type -->
                <span *ngSwitchCase="'switch'">
                  <nz-switch
                    [ngModel]="getColumnValue(data, column)"
                    [nzDisabled]="isColumnDisabled(data, column)"
                    (ngModelChange)="onStatusChange(data, column, $event)"
                  >
                  </nz-switch>
                </span>

                <!-- Percent Type -->
                <span *ngSwitchCase="'percent'">
                  {{ getColumnValue(data, column) | percent }}
                </span>

                <!-- Image Type -->
                <span *ngSwitchCase="'image'">
                  <img
                    [src]="getColumnValue(data, column)"
                    [alt]="column.title"
                    style="width: 50px; height: 50px; object-fit: cover"
                    *ngIf="getColumnValue(data, column)"
                  />
                  <span *ngIf="!getColumnValue(data, column)">No Image</span>
                </span>

                <!-- Long Text Type -->
                <span
                  *ngSwitchCase="'long-text'"
                  [title]="getColumnValue(data, column)"
                >
                  {{ truncateText(getColumnValue(data, column), 50) }}
                </span>

                <!-- Button Type -->
                <span *ngSwitchCase="'button'">
                  <button
                    nz-button
                    nzType="primary"
                    nzSize="small"
                    [disabled]="isColumnDisabled(data, column)"
                    (click)="onColumnClick(data, column)"
                  >
                    {{ column.title }}
                  </button>
                </span>

                <!-- Custom Render Type -->
                <span
                  *ngSwitchCase="'custom-render'"
                  [innerHTML]="getCustomRender(data, column)"
                >
                </span>

                <!-- Template Type -->
                <ng-container *ngSwitchCase="'template'">
                  <ng-container
                    *ngTemplateOutlet="
                      getColumnTemplate(column);
                      context: { $implicit: data, column: column }
                    "
                  >
                  </ng-container>
                </ng-container>

                <!-- Default case (fallback to text) -->
                <span *ngSwitchDefault>
                  {{ getColumnValue(data, column) }}
                </span>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>

  <!-- Sticky Pagination Outside Scroll Area -->
  <div class="table-pagination-container">
    <nz-pagination
      [nzPageIndex]="currentPage"
      [nzTotal]="total"
      [nzPageSize]="pageSize"
      [nzPageSizeOptions]="pageSizeOptions"
      [nzShowSizeChanger]="true"
      [nzShowQuickJumper]="false"
      [nzShowTotal]="totalTemplate"
      (nzPageIndexChange)="onPageChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      class="table-pagination"
    ></nz-pagination>

    <ng-template #totalTemplate let-total let-range="range">
      <span class="pagination-total">
        {{ range[0] }}-{{ range[1] }} of {{ total }} items
      </span>
    </ng-template>
  </div>
</div>
