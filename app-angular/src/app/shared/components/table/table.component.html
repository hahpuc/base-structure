<div class="kt-card w-full p-4">
  <div class="ft-table-container w-full m-0 p-0 grid">
    <div class="card card-grid h-full min-w-full">
      <!-- Table Filter -->
      @if (option.filterable && option.filters && option.filters.length > 0) {
        <app-table-filter
          [filters]="option.filters!"
          [initialFilterValues]="currentFilters"
          (filterChange)="onFilterChange($event)"
          (clearFilter)="onClearFilter()"
        ></app-table-filter>
      }

      <!-- Responsive Table Container -->
      <div class="card-body">
        @if (option && option.columns) {
          <!-- Basic Ant Design Table -->
          <nz-table
            #basicTable
            [nzData]="tableData || []"
            [nzLoading]="loading"
            [nzPageSize]="pageSize"
            [nzShowSizeChanger]="true"
            [nzTotal]="total"
            [nzPageIndex]="currentPage"
            [nzPageSizeOptions]="pageSizeOptions"
            (nzPageIndexChange)="onPageChange($event)"
            (nzPageSizeChange)="onPageSizeChange($event)"
            [nzShowPagination]="false"
            [nzScroll]="getTableScrollX()"
            nzBordered
            [nzFrontPagination]="false"
          >
            <!-- Table Header -->
            <thead>
              <tr>
                @if (option.actions && option.actions.length > 0) {
                  <th [nzWidth]="getActionColumnWidth()" [style]="getActionColumnStyle()" nzLeft></th>
                }
                @for (column of option.columns; track trackByColumn($index, column)) {
                  <th
                    [hidden]="!isColumnVisibleSync(column)"
                    [nzDisabled]="!isColumnResizable(column)"
                    [nzShowSort]="column.sortable"
                    [nzSortFn]="getSortFn(column)"
                    [nzSortOrder]="getSortDirection(column)"
                    (nzSortOrderChange)="onSortChange(column, $event)"
                    [nzLeft]="column.fixed === 'left'"
                    [nzRight]="column.fixed === 'right'"
                    nz-resizable
                    (nzResizeEnd)="onColumnResize(column, $event.width!)"
                    [nzWidth]="getColumnWidth(column)"
                    [nzMinWidth]="getColumnMinWidth(column)"
                    [nzMaxWidth]="getColumnMaxWidth(column)"
                    [style.min-width]="getColumnWidth(column)"
                    [style.width]="getColumnWidth(column)"
                    [class]="'resize-table-th ' + getColumnAlignClass(column)"
                  >
                    {{ column.title }}
                    @if (isColumnResizable(column)) {
                      <nz-resize-handle nzDirection="right" class="table-resize-handle">
                        <div class="resize-trigger"></div>
                      </nz-resize-handle>
                    }
                  </th>
                }
              </tr>
            </thead>

            <!-- Table Body -->
            <tbody>
              @for (data of basicTable.data; track trackByData($index, data)) {
                <tr>
                  <!-- Actions -->
                  @if (option.actions && option.actions.length > 0) {
                    <td nzLeft [style]="getActionColumnStyle()">
                      <div class="flex flex-row gap-2 items-center">
                        @for (action of option.actions; track action) {
                          <button
                            [title]="action.label"
                            (click)="onActionClick(data, action)"
                            [class]="getActionButtonClasses(action)"
                            [hidden]="!isActionVisibleSync(action, data)"
                          >
                            @if (action.iconClass) {
                              <i [class]="action.iconClass + ' ' + getActionIconClasses(action)"></i>
                            }
                          </button>
                        }
                      </div>
                    </td>
                  }

                  <!-- Column Data -->
                  @for (column of option.columns; track trackByColumn($index, column)) {
                    <td
                      [nzLeft]="column.fixed === 'left'"
                      [nzRight]="column.fixed === 'right'"
                      [hidden]="!isColumnVisibleSync(column)"
                      [style.min-width]="getColumnWidth(column)"
                      [style.width]="getColumnWidth(column)"
                      [style.max-width]="getColumnWidth(column)"
                      [class]="getColumnAlignClass(column)"
                    >
                      @switch (getColumnType(column)) {
                        <!-- Text Type -->
                        @case ('text') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            {{ getColumnValue(data, column) }}
                          </span>
                        }

                        <!-- Number Type -->
                        @case ('number') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            {{ getNumberValue(data, column) | number }}
                          </span>
                        }

                        <!-- Date Type -->
                        @case ('date') {
                          <span>
                            {{ getDateValue(data, column) | date: 'dd/MM/yyyy' }}
                          </span>
                        }

                        <!-- DateTime Type -->
                        @case ('datetime') {
                          <span>
                            {{ getDateValue(data, column) | date: 'dd/MM/yyyy HH:mm' }}
                          </span>
                        }

                        <!-- Time Type -->
                        @case ('time') {
                          <span>
                            {{ getDateValue(data, column) | date: 'HH:mm' }}
                          </span>
                        }

                        <!-- Boolean Type -->
                        @case ('boolean') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            <nz-tag [nzColor]="getColumnValue(data, column) ? 'green' : 'red'">
                              {{ getColumnValue(data, column) ? 'Yes' : 'No' }}
                            </nz-tag>
                          </span>
                        }

                        <!-- Status Type (Switch) -->
                        @case ('status') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            <nz-switch
                              [ngModel]="getColumnValue(data, column)"
                              [nzDisabled]="isColumnDisabled(data, column)"
                              (ngModelChange)="onStatusChange(data, column, $event)"
                            >
                            </nz-switch>
                          </span>
                        }

                        <!-- Switch Type -->
                        @case ('switch') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            <nz-switch
                              [ngModel]="getColumnValue(data, column)"
                              [nzDisabled]="isColumnDisabled(data, column)"
                              (ngModelChange)="onStatusChange(data, column, $event)"
                            >
                            </nz-switch>
                          </span>
                        }

                        <!-- Percent Type -->
                        @case ('percent') {
                          <span>
                            {{ getNumberValue(data, column) | percent }}
                          </span>
                        }

                        <!-- Image Type -->
                        @case ('image') {
                          <span [class]="'flex ' + getColumnFlexAlignClass(column)">
                            @if (getStringValue(data, column)) {
                              <img
                                [src]="getStringValue(data, column)"
                                [alt]="column.title"
                                class="w-12 h-12 object-cover rounded cursor-pointer transition-all duration-200 hover:scale-110 hover:shadow-lg"
                                (click)="showPreviewImage(getStringValue(data, column))"
                                title="Click to preview image"
                              />
                            } @else {
                              <span>No Image</span>
                            }
                          </span>
                        }

                        <!-- Long Text Type -->
                        @case ('long-text') {
                          <span [title]="getStringValue(data, column)">
                            {{ truncateText(getStringValue(data, column), 50) }}
                          </span>
                        }

                        <!-- Button Type -->
                        @case ('button') {
                          <span>
                            <button
                              nz-button
                              nzType="primary"
                              nzSize="small"
                              [disabled]="isColumnDisabled(data, column)"
                              (click)="onColumnClick(data, column)"
                            >
                              {{ column.title }}
                            </button>
                          </span>
                        }

                        <!-- Custom Render Type -->
                        @case ('custom-render') {
                          <span
                            [innerHTML]="getCustomRender(data, column)"
                            (click)="onColumnClick(data, column)"
                            style="cursor: pointer"
                          ></span>
                        }

                        <!-- Template Type -->
                        @case ('template') {
                          <ng-container
                            *ngTemplateOutlet="getColumnTemplate(column); context: { $implicit: data, column: column }"
                          >
                          </ng-container>
                        }

                        <!-- Default case (fallback to text) -->
                        @default {
                          <span>
                            {{ getColumnValue(data, column) }}
                          </span>
                        }
                      }
                    </td>
                  }
                </tr>
              }
            </tbody>
          </nz-table>
        }
      </div>

      <!-- Sticky Pagination Outside Scroll Area -->
      <div class="table-pagination-container">
        <nz-pagination
          [nzPageIndex]="currentPage"
          [nzTotal]="total"
          [nzPageSize]="pageSize"
          [nzPageSizeOptions]="pageSizeOptions"
          [nzShowSizeChanger]="true"
          [nzShowQuickJumper]="false"
          [nzShowTotal]="totalTemplate"
          (nzPageIndexChange)="onPageChange($event)"
          (nzPageSizeChange)="onPageSizeChange($event)"
          class="table-pagination"
        ></nz-pagination>

        <ng-template #totalTemplate let-total let-range="range">
          <span class="pagination-total"> {{ range[0] }}-{{ range[1] }} of {{ total }} items </span>
        </ng-template>
      </div>
    </div>
    <!-- Table Title -->
    <!-- <div class="table-header" *ngIf="option?.title">
    <h4 class="table-title">{{ option.title }}</h4>
  </div> -->
  </div>
</div>
