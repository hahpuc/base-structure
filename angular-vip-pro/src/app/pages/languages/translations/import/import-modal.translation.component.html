<nz-modal
  [(nzVisible)]="isVisible"
  nzTitle="Import/Export Translations"
  [nzWidth]="600"
  [nzFooter]="null"
  (nzOnCancel)="handleCancel()"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="form" [nzLayout]="'vertical'">
      <!-- Language Selection -->
      <nz-form-item>
        <nz-form-label nzRequired>Language</nz-form-label>
        <nz-form-control nzErrorTip="Please select a language">
          <nz-select formControlName="languageId" nzPlaceHolder="Select a language" nzShowSearch class="w-full">
            <nz-option
              *ngFor="let option of languageOptions$ | async; trackBy: trackByValue"
              [nzValue]="option.value"
              [nzLabel]="option.label"
            ></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <!-- Action Buttons -->
      <div class="flex gap-4 mb-6">
        <button
          nz-button
          nzType="default"
          [nzLoading]="isExporting"
          [disabled]="!isLanguageSelected"
          (click)="handleExport()"
          class="flex-1"
        >
          Export Translations
        </button>

        <button
          nz-button
          nzType="primary"
          [nzLoading]="isImporting"
          [disabled]="!isLanguageSelected || !hasFileSelected"
          (click)="handleImport()"
          class="flex-1"
        >
          {{ isImporting ? 'Importing...' : 'Import Translations' }}
        </button>
      </div>

      <!-- File Upload Section -->
      @if (isLanguageSelected) {
        <nz-form-item>
          <nz-form-label>Import File</nz-form-label>
          <nz-form-control nzErrorTip="Please select an Excel file">
            <app-file-upload
              #fileUpload
              [accept]="uploadAcceptType"
              [type]="uploadFileType"
              [maxSize]="maxFileSize"
              [nzListType]="'text'"
              [showUploadList]="true"
            ></app-file-upload>
          </nz-form-control>
        </nz-form-item>
      }

      <!-- Import Result Section -->
      @if (importResult) {
        <div
          class="mt-4 p-4 rounded-lg"
          [ngClass]="{
            'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-700/50': importResult.success,
            'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700/50': !importResult.success,
          }"
        >
          <div class="flex items-start justify-between">
            <div>
              <h4
                class="text-sm font-medium"
                [ngClass]="{
                  'text-green-800 dark:text-green-200': importResult.success,
                  'text-red-800 dark:text-red-200': !importResult.success,
                }"
              >
                {{ importResult.success ? 'Import Successful' : 'Import Failed' }}
              </h4>
              <p
                class="text-sm mt-1"
                [ngClass]="{
                  'text-green-700 dark:text-green-300': importResult.success,
                  'text-red-700 dark:text-red-300': !importResult.success,
                }"
              >
                {{ importResult.message }}
              </p>
            </div>
            @if (!importResult.success && importResult.errorKey) {
              <button
                nz-button
                nzType="link"
                nzSize="small"
                (click)="downloadErrorFile(importResult.errorKey)"
                class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"
              >
                Download Error File
              </button>
            }
          </div>
        </div>
      }

      <!-- Instructions -->
      <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700/50 rounded-lg p-4 mt-4">
        <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">Instructions:</h4>
        <ol class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
          <li>1. Select a language from the dropdown above</li>
          <li>2. Click "Export Translations" to download current translations</li>
          <li>3. Edit the downloaded Excel file with your translations</li>
          <li>4. Upload the modified file and click "Import Translations"</li>
        </ol>
      </div>
    </form>
  </ng-container>
</nz-modal>
